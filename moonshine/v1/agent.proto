syntax = "proto3";

package moonshine.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "moonshine/v1/user.proto";

service AgentService {
  rpc CreateAgent(CreateAgentRequest) returns (CreateAgentResponse) {}
  rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse) {}
  rpc DeleteAgent(DeleteAgentRequest) returns (DeleteAgentResponse) {}
  
  rpc CreateAPIKey(CreateAPIKeyRequest) returns (CreateAPIKeyResponse) {}
  rpc ListAPIKeys(ListAPIKeysRequest) returns (ListAPIKeysResponse) {}
  rpc RevokeAPIKey(RevokeAPIKeyRequest) returns (RevokeAPIKeyResponse) {}
}

message CreateAgentRequest {
  string username = 1 [(buf.validate.field).string = {min_len: 3, max_len: 32}];
}

message CreateAgentResponse {
  User user = 1;
  string api_key = 2;
}

message ListAgentsRequest {}

message ListAgentsResponse {
  repeated User agents = 1;
}

message DeleteAgentRequest {
  string agent_id = 1 [(buf.validate.field).string.uuid = true];
}

message DeleteAgentResponse {}

message CreateAPIKeyRequest {
  string user_id = 1 [(buf.validate.field).string.uuid = true];
  repeated string scopes = 2;
  google.protobuf.Timestamp expires_at = 3;
}

message CreateAPIKeyResponse {
  string api_key = 1;
}

message APIKey {
  string id = 1;
  string user_id = 2;
  repeated string scopes = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp expires_at = 5;
  string created_by = 6;
}

message ListAPIKeysRequest {
  string user_id = 1 [(buf.validate.field).string.uuid = true];
}

message ListAPIKeysResponse {
  repeated APIKey api_keys = 1;
}

message RevokeAPIKeyRequest {
  string id = 1 [(buf.validate.field).string.uuid = true];
}

message RevokeAPIKeyResponse {}
